"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/admin/documents";
exports.ids = ["pages/api/admin/documents"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fdocuments&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fdocuments.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fdocuments&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fdocuments.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/admin/documents.ts */ \"(api)/./pages/api/admin/documents.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/admin/documents\",\n        pathname: \"/api/admin/documents\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_admin_documents_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFkbWluJTJGZG9jdW1lbnRzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZhZG1pbiUyRmRvY3VtZW50cy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUMyRDtBQUMzRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsMERBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDBEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbGVzLWNoYXQtb3BlbmFpLXJhZy8/NWYwMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2FkbWluL2RvY3VtZW50cy50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2FkbWluL2RvY3VtZW50c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FkbWluL2RvY3VtZW50c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fdocuments&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fdocuments.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/admin/documents.ts":
/*!**************************************!*\
  !*** ./pages/api/admin/documents.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _utils_errorHandling__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/errorHandling */ \"(api)/./utils/errorHandling.ts\");\n/* harmony import */ var _utils_vectorStore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/vectorStore */ \"(api)/./utils/vectorStore.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_utils_errorHandling__WEBPACK_IMPORTED_MODULE_0__]);\n_utils_errorHandling__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nasync function handler(req, res) {\n    // Only allow GET requests\n    if (req.method !== \"GET\") {\n        return res.status(405).json({\n            error: {\n                message: \"Method Not Allowed\",\n                code: \"method_not_allowed\"\n            }\n        });\n    }\n    try {\n        // Get the limit parameter (default to 100)\n        const limit = req.query.limit ? parseInt(req.query.limit, 10) : 100;\n        // Get documents from vector store\n        console.log(\"Fetching vector store items...\");\n        const vectorStoreItems = (0,_utils_vectorStore__WEBPACK_IMPORTED_MODULE_1__.getAllVectorStoreItems)();\n        console.log(`Retrieved ${vectorStoreItems.length} vector store items`);\n        // Transform items to the format expected by the UI\n        console.log(`Processing up to ${limit} items for UI display`);\n        const documents = vectorStoreItems.slice(0, limit).map((item)=>({\n                id: item.metadata?.source || `doc-${Math.random().toString(36).substring(7)}`,\n                source: item.metadata?.source || \"Unknown Source\",\n                text: item.text || \"\",\n                metadata: {\n                    ...item.metadata,\n                    // Ensure source is always available\n                    source: item.metadata?.source || \"Unknown Source\"\n                }\n            }));\n        console.log(`Returning ${documents.length} documents to client`);\n        // Return the documents\n        return res.status(200).json({\n            documents,\n            total: vectorStoreItems.length,\n            limit\n        });\n    } catch (error) {\n        console.error(\"Error fetching documents:\", error);\n        const errorResponse = (0,_utils_errorHandling__WEBPACK_IMPORTED_MODULE_0__.standardizeApiErrorResponse)(error);\n        return res.status(500).json(errorResponse);\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYWRtaW4vZG9jdW1lbnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUMyRTtBQUNVO0FBRXRFLGVBQWVFLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLDBCQUEwQjtJQUMxQixJQUFJRCxJQUFJRSxNQUFNLEtBQUssT0FBTztRQUN4QixPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87Z0JBQUVDLFNBQVM7Z0JBQXNCQyxNQUFNO1lBQXFCO1FBQUU7SUFDckc7SUFFQSxJQUFJO1FBQ0YsMkNBQTJDO1FBQzNDLE1BQU1DLFFBQVFSLElBQUlTLEtBQUssQ0FBQ0QsS0FBSyxHQUFHRSxTQUFTVixJQUFJUyxLQUFLLENBQUNELEtBQUssRUFBWSxNQUFNO1FBRTFFLGtDQUFrQztRQUNsQ0csUUFBUUMsR0FBRyxDQUFDO1FBQ1osTUFBTUMsbUJBQW1CZiwwRUFBc0JBO1FBQy9DYSxRQUFRQyxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUVDLGlCQUFpQkMsTUFBTSxDQUFDLG1CQUFtQixDQUFDO1FBRXJFLG1EQUFtRDtRQUNuREgsUUFBUUMsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUVKLE1BQU0scUJBQXFCLENBQUM7UUFDNUQsTUFBTU8sWUFBWUYsaUJBQWlCRyxLQUFLLENBQUMsR0FBR1IsT0FBT1MsR0FBRyxDQUFDLENBQUNDLE9BQTJCO2dCQUNqRkMsSUFBSUQsS0FBS0UsUUFBUSxFQUFFQyxVQUFVLENBQUMsSUFBSSxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxTQUFTLENBQUMsR0FBRyxDQUFDO2dCQUM3RUosUUFBUUgsS0FBS0UsUUFBUSxFQUFFQyxVQUFVO2dCQUNqQ0ssTUFBTVIsS0FBS1EsSUFBSSxJQUFJO2dCQUNuQk4sVUFBVTtvQkFDUixHQUFHRixLQUFLRSxRQUFRO29CQUNoQixvQ0FBb0M7b0JBQ3BDQyxRQUFRSCxLQUFLRSxRQUFRLEVBQUVDLFVBQVU7Z0JBQ25DO1lBQ0Y7UUFFQVYsUUFBUUMsR0FBRyxDQUFDLENBQUMsVUFBVSxFQUFFRyxVQUFVRCxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFL0QsdUJBQXVCO1FBQ3ZCLE9BQU9iLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJXO1lBQ0FZLE9BQU9kLGlCQUFpQkMsTUFBTTtZQUM5Qk47UUFDRjtJQUNGLEVBQUUsT0FBT0gsT0FBTztRQUNkTSxRQUFRTixLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxNQUFNdUIsZ0JBQWdCL0IsaUZBQTJCQSxDQUFDUTtRQUNsRCxPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDd0I7SUFDOUI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbGVzLWNoYXQtb3BlbmFpLXJhZy8uL3BhZ2VzL2FwaS9hZG1pbi9kb2N1bWVudHMudHM/ZDFjOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyBzdGFuZGFyZGl6ZUFwaUVycm9yUmVzcG9uc2UgfSBmcm9tICcuLi8uLi8uLi91dGlscy9lcnJvckhhbmRsaW5nJztcbmltcG9ydCB7IGdldEFsbFZlY3RvclN0b3JlSXRlbXMsIFZlY3RvclN0b3JlSXRlbSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3ZlY3RvclN0b3JlJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICAvLyBPbmx5IGFsbG93IEdFVCByZXF1ZXN0c1xuICBpZiAocmVxLm1ldGhvZCAhPT0gJ0dFVCcpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogeyBtZXNzYWdlOiAnTWV0aG9kIE5vdCBBbGxvd2VkJywgY29kZTogJ21ldGhvZF9ub3RfYWxsb3dlZCcgfSB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgLy8gR2V0IHRoZSBsaW1pdCBwYXJhbWV0ZXIgKGRlZmF1bHQgdG8gMTAwKVxuICAgIGNvbnN0IGxpbWl0ID0gcmVxLnF1ZXJ5LmxpbWl0ID8gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0IGFzIHN0cmluZywgMTApIDogMTAwO1xuICAgIFxuICAgIC8vIEdldCBkb2N1bWVudHMgZnJvbSB2ZWN0b3Igc3RvcmVcbiAgICBjb25zb2xlLmxvZygnRmV0Y2hpbmcgdmVjdG9yIHN0b3JlIGl0ZW1zLi4uJyk7XG4gICAgY29uc3QgdmVjdG9yU3RvcmVJdGVtcyA9IGdldEFsbFZlY3RvclN0b3JlSXRlbXMoKTtcbiAgICBjb25zb2xlLmxvZyhgUmV0cmlldmVkICR7dmVjdG9yU3RvcmVJdGVtcy5sZW5ndGh9IHZlY3RvciBzdG9yZSBpdGVtc2ApO1xuICAgIFxuICAgIC8vIFRyYW5zZm9ybSBpdGVtcyB0byB0aGUgZm9ybWF0IGV4cGVjdGVkIGJ5IHRoZSBVSVxuICAgIGNvbnNvbGUubG9nKGBQcm9jZXNzaW5nIHVwIHRvICR7bGltaXR9IGl0ZW1zIGZvciBVSSBkaXNwbGF5YCk7XG4gICAgY29uc3QgZG9jdW1lbnRzID0gdmVjdG9yU3RvcmVJdGVtcy5zbGljZSgwLCBsaW1pdCkubWFwKChpdGVtOiBWZWN0b3JTdG9yZUl0ZW0pID0+ICh7XG4gICAgICBpZDogaXRlbS5tZXRhZGF0YT8uc291cmNlIHx8IGBkb2MtJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyl9YCxcbiAgICAgIHNvdXJjZTogaXRlbS5tZXRhZGF0YT8uc291cmNlIHx8ICdVbmtub3duIFNvdXJjZScsXG4gICAgICB0ZXh0OiBpdGVtLnRleHQgfHwgJycsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5pdGVtLm1ldGFkYXRhLFxuICAgICAgICAvLyBFbnN1cmUgc291cmNlIGlzIGFsd2F5cyBhdmFpbGFibGVcbiAgICAgICAgc291cmNlOiBpdGVtLm1ldGFkYXRhPy5zb3VyY2UgfHwgJ1Vua25vd24gU291cmNlJyxcbiAgICAgIH1cbiAgICB9KSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coYFJldHVybmluZyAke2RvY3VtZW50cy5sZW5ndGh9IGRvY3VtZW50cyB0byBjbGllbnRgKTtcbiAgICBcbiAgICAvLyBSZXR1cm4gdGhlIGRvY3VtZW50c1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICBkb2N1bWVudHMsXG4gICAgICB0b3RhbDogdmVjdG9yU3RvcmVJdGVtcy5sZW5ndGgsXG4gICAgICBsaW1pdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGRvY3VtZW50czonLCBlcnJvcik7XG4gICAgY29uc3QgZXJyb3JSZXNwb25zZSA9IHN0YW5kYXJkaXplQXBpRXJyb3JSZXNwb25zZShlcnJvcik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKGVycm9yUmVzcG9uc2UpO1xuICB9XG59ICJdLCJuYW1lcyI6WyJzdGFuZGFyZGl6ZUFwaUVycm9yUmVzcG9uc2UiLCJnZXRBbGxWZWN0b3JTdG9yZUl0ZW1zIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwibGltaXQiLCJxdWVyeSIsInBhcnNlSW50IiwiY29uc29sZSIsImxvZyIsInZlY3RvclN0b3JlSXRlbXMiLCJsZW5ndGgiLCJkb2N1bWVudHMiLCJzbGljZSIsIm1hcCIsIml0ZW0iLCJpZCIsIm1ldGFkYXRhIiwic291cmNlIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwidGV4dCIsInRvdGFsIiwiZXJyb3JSZXNwb25zZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/admin/documents.ts\n");

/***/ }),

/***/ "(api)/./utils/errorHandling.ts":
/*!********************************!*\
  !*** ./utils/errorHandling.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIModelError: () => (/* binding */ AIModelError),\n/* harmony export */   DocumentProcessingError: () => (/* binding */ DocumentProcessingError),\n/* harmony export */   NetworkError: () => (/* binding */ NetworkError),\n/* harmony export */   QueryProcessingError: () => (/* binding */ QueryProcessingError),\n/* harmony export */   VectorStoreError: () => (/* binding */ VectorStoreError),\n/* harmony export */   createError: () => (/* binding */ createError),\n/* harmony export */   createFallbackResponse: () => (/* binding */ createFallbackResponse),\n/* harmony export */   formatValidationError: () => (/* binding */ formatValidationError),\n/* harmony export */   handleError: () => (/* binding */ handleError),\n/* harmony export */   handleOpenAIError: () => (/* binding */ handleOpenAIError),\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   safeExecute: () => (/* binding */ safeExecute),\n/* harmony export */   standardizeApiErrorResponse: () => (/* binding */ standardizeApiErrorResponse)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Custom error classes for better error identification\nclass DocumentProcessingError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"DocumentProcessingError\";\n    }\n}\nclass AIModelError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"AIModelError\";\n    }\n}\nclass VectorStoreError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"VectorStoreError\";\n    }\n}\nclass NetworkError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"NetworkError\";\n    }\n}\nclass QueryProcessingError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"QueryProcessingError\";\n    }\n}\n// Error handler for OpenAI API errors\nfunction handleOpenAIError(error) {\n    if (error instanceof openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI.APIError) {\n        if (error.status === 400) {\n            return new AIModelError(`Invalid request to OpenAI: ${error.message}`, error);\n        } else if (error.status === 401) {\n            return new AIModelError(\"Authentication error with OpenAI API. Check your API key.\", error);\n        } else if (error.status === 429) {\n            return new AIModelError(\"Rate limit exceeded with OpenAI API. Please try again later.\", error);\n        } else if (error.status >= 500) {\n            return new AIModelError(\"OpenAI service is currently unavailable. Please try again later.\", error);\n        }\n    }\n    return new AIModelError(`Unexpected error with OpenAI: ${error instanceof Error ? error.message : String(error)}`, error instanceof Error ? error : undefined);\n}\n// General purpose error handler\nfunction handleError(error, context) {\n    // Log the error for debugging\n    console.error(`Error in ${context}:`, error);\n    // Specific handling based on error type\n    if (error instanceof openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI.APIError) {\n        return handleOpenAIError(error);\n    }\n    if (error instanceof DocumentProcessingError || error instanceof AIModelError || error instanceof VectorStoreError || error instanceof NetworkError || error instanceof QueryProcessingError) {\n        return error; // Already a custom error, return as is\n    }\n    // Generic error handling\n    const message = error instanceof Error ? error.message : String(error);\n    return new Error(`Error in ${context}: ${message}`);\n}\n// Helper for fallback response creation\nfunction createFallbackResponse(defaultValue) {\n    return defaultValue;\n}\n// Type-safe try/catch wrapper for async functions\nasync function safeExecute(operation, context, fallback) {\n    try {\n        return await operation();\n    } catch (error) {\n        handleError(error, context);\n        return fallback;\n    }\n}\n/**\n * Standardize error responses for API endpoints\n * This ensures consistent error formatting across the application\n */ function standardizeApiErrorResponse(error) {\n    console.error(\"Error details:\", error);\n    // Handle OpenAI API errors\n    if (error.name === \"OpenAIError\" || error.response && error.response.headers && error.response.headers.get(\"x-request-id\")) {\n        return {\n            error: {\n                message: \"Error processing your request with the language model\",\n                code: \"OPENAI_API_ERROR\",\n                details:  true ? {\n                    message: error.message,\n                    type: error.type,\n                    statusCode: error.status || error.statusCode\n                } : 0\n            }\n        };\n    }\n    // Handle vector store errors\n    if (error.message && error.message.includes(\"vector store\")) {\n        return {\n            error: {\n                message: \"Error retrieving information from knowledge base\",\n                code: \"VECTOR_STORE_ERROR\",\n                details:  true ? {\n                    message: error.message\n                } : 0\n            }\n        };\n    }\n    // Handle timeout errors\n    if (error.name === \"AbortError\" || error.code === \"ETIMEDOUT\" || error.message?.includes(\"timeout\")) {\n        return {\n            error: {\n                message: \"Request timed out. Please try again.\",\n                code: \"TIMEOUT_ERROR\",\n                details:  true ? {\n                    message: error.message\n                } : 0\n            }\n        };\n    }\n    // Default error response\n    return {\n        error: {\n            message: \"An unexpected error occurred\",\n            code: \"INTERNAL_SERVER_ERROR\",\n            details:  true ? {\n                message: error.message || \"Unknown error\"\n            } : 0\n        }\n    };\n}\n/**\n * Format validation errors consistently\n */ function formatValidationError(message, fieldErrors) {\n    return {\n        error: {\n            message: message || \"Validation error\",\n            code: \"VALIDATION_ERROR\",\n            details: fieldErrors\n        }\n    };\n}\n/**\n * Log error with standardized format for easier debugging\n */ function logError(error, context) {\n    const timestamp = new Date().toISOString();\n    const contextInfo = context ? `[${context}] ` : \"\";\n    console.error(`${timestamp} ${contextInfo}Error: ${error.message}`);\n    if (error.stack && \"development\" !== \"production\") {\n        console.error(`Stack trace: ${error.stack}`);\n    }\n    // Log additional details if available\n    if (error.response) {\n        console.error(\"Response data:\", error.response.data);\n        console.error(\"Response status:\", error.response.status);\n    }\n}\n/**\n * Create a simple error with additional context\n */ function createError(message, code, additionalDetails) {\n    const error = new Error(message);\n    if (code) error.code = code;\n    if (additionalDetails) error.details = additionalDetails;\n    return error;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDN0IsSUFBSXlCLE1BQU1qQixNQUFNaUIsSUFBSSxHQUFHQTtJQUN2QixJQUFJZ0IsbUJBQW1CakMsTUFBTWtCLE9BQU8sR0FBR2U7SUFDdkMsT0FBT2pDO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWxlcy1jaGF0LW9wZW5haS1yYWcvLi91dGlscy9lcnJvckhhbmRsaW5nLnRzPzdiZWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlbkFJIH0gZnJvbSAnb3BlbmFpJztcblxuLy8gQ3VzdG9tIGVycm9yIGNsYXNzZXMgZm9yIGJldHRlciBlcnJvciBpZGVudGlmaWNhdGlvblxuZXhwb3J0IGNsYXNzIERvY3VtZW50UHJvY2Vzc2luZ0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHB1YmxpYyByZWFkb25seSBvcmlnaW5hbEVycm9yPzogRXJyb3IpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnRG9jdW1lbnRQcm9jZXNzaW5nRXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBSU1vZGVsRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgcHVibGljIHJlYWRvbmx5IG9yaWdpbmFsRXJyb3I/OiBFcnJvcikge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdBSU1vZGVsRXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBWZWN0b3JTdG9yZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHB1YmxpYyByZWFkb25seSBvcmlnaW5hbEVycm9yPzogRXJyb3IpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnVmVjdG9yU3RvcmVFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5ldHdvcmtFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBwdWJsaWMgcmVhZG9ubHkgb3JpZ2luYWxFcnJvcj86IEVycm9yKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ05ldHdvcmtFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFF1ZXJ5UHJvY2Vzc2luZ0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHB1YmxpYyByZWFkb25seSBvcmlnaW5hbEVycm9yPzogRXJyb3IpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnUXVlcnlQcm9jZXNzaW5nRXJyb3InO1xuICB9XG59XG5cbi8vIEVycm9yIGhhbmRsZXIgZm9yIE9wZW5BSSBBUEkgZXJyb3JzXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlT3BlbkFJRXJyb3IoZXJyb3I6IHVua25vd24pOiBBSU1vZGVsRXJyb3Ige1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBPcGVuQUkuQVBJRXJyb3IpIHtcbiAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDApIHtcbiAgICAgIHJldHVybiBuZXcgQUlNb2RlbEVycm9yKGBJbnZhbGlkIHJlcXVlc3QgdG8gT3BlbkFJOiAke2Vycm9yLm1lc3NhZ2V9YCwgZXJyb3IpO1xuICAgIH0gZWxzZSBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgIHJldHVybiBuZXcgQUlNb2RlbEVycm9yKCdBdXRoZW50aWNhdGlvbiBlcnJvciB3aXRoIE9wZW5BSSBBUEkuIENoZWNrIHlvdXIgQVBJIGtleS4nLCBlcnJvcik7XG4gICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDQyOSkge1xuICAgICAgcmV0dXJuIG5ldyBBSU1vZGVsRXJyb3IoJ1JhdGUgbGltaXQgZXhjZWVkZWQgd2l0aCBPcGVuQUkgQVBJLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsIGVycm9yKTtcbiAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA+PSA1MDApIHtcbiAgICAgIHJldHVybiBuZXcgQUlNb2RlbEVycm9yKCdPcGVuQUkgc2VydmljZSBpcyBjdXJyZW50bHkgdW5hdmFpbGFibGUuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIG5ldyBBSU1vZGVsRXJyb3IoYFVuZXhwZWN0ZWQgZXJyb3Igd2l0aCBPcGVuQUk6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsIFxuICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IHVuZGVmaW5lZCk7XG59XG5cbi8vIEdlbmVyYWwgcHVycG9zZSBlcnJvciBoYW5kbGVyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyb3I6IHVua25vd24sIGNvbnRleHQ6IHN0cmluZyk6IEVycm9yIHtcbiAgLy8gTG9nIHRoZSBlcnJvciBmb3IgZGVidWdnaW5nXG4gIGNvbnNvbGUuZXJyb3IoYEVycm9yIGluICR7Y29udGV4dH06YCwgZXJyb3IpO1xuICBcbiAgLy8gU3BlY2lmaWMgaGFuZGxpbmcgYmFzZWQgb24gZXJyb3IgdHlwZVxuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBPcGVuQUkuQVBJRXJyb3IpIHtcbiAgICByZXR1cm4gaGFuZGxlT3BlbkFJRXJyb3IoZXJyb3IpO1xuICB9XG4gIFxuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBEb2N1bWVudFByb2Nlc3NpbmdFcnJvciB8fCBcbiAgICAgIGVycm9yIGluc3RhbmNlb2YgQUlNb2RlbEVycm9yIHx8IFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBWZWN0b3JTdG9yZUVycm9yIHx8XG4gICAgICBlcnJvciBpbnN0YW5jZW9mIE5ldHdvcmtFcnJvciB8fFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBRdWVyeVByb2Nlc3NpbmdFcnJvcikge1xuICAgIHJldHVybiBlcnJvcjsgLy8gQWxyZWFkeSBhIGN1c3RvbSBlcnJvciwgcmV0dXJuIGFzIGlzXG4gIH1cbiAgXG4gIC8vIEdlbmVyaWMgZXJyb3IgaGFuZGxpbmdcbiAgY29uc3QgbWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgcmV0dXJuIG5ldyBFcnJvcihgRXJyb3IgaW4gJHtjb250ZXh0fTogJHttZXNzYWdlfWApO1xufVxuXG4vLyBIZWxwZXIgZm9yIGZhbGxiYWNrIHJlc3BvbnNlIGNyZWF0aW9uXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmFsbGJhY2tSZXNwb25zZTxUPihkZWZhdWx0VmFsdWU6IFQpOiBUIHtcbiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbn1cblxuLy8gVHlwZS1zYWZlIHRyeS9jYXRjaCB3cmFwcGVyIGZvciBhc3luYyBmdW5jdGlvbnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYWZlRXhlY3V0ZTxUPihcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+LFxuICBjb250ZXh0OiBzdHJpbmcsXG4gIGZhbGxiYWNrOiBUXG4pOiBQcm9taXNlPFQ+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgb3BlcmF0aW9uKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaGFuZGxlRXJyb3IoZXJyb3IsIGNvbnRleHQpO1xuICAgIHJldHVybiBmYWxsYmFjaztcbiAgfVxufVxuXG4vKipcbiAqIFN0YW5kYXJkIEFQSSBlcnJvciByZXNwb25zZSBmb3JtYXRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBcGlFcnJvclJlc3BvbnNlIHtcbiAgZXJyb3I6IHtcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIGRldGFpbHM/OiBhbnk7XG4gIH07XG59XG5cbi8qKlxuICogU3RhbmRhcmRpemUgZXJyb3IgcmVzcG9uc2VzIGZvciBBUEkgZW5kcG9pbnRzXG4gKiBUaGlzIGVuc3VyZXMgY29uc2lzdGVudCBlcnJvciBmb3JtYXR0aW5nIGFjcm9zcyB0aGUgYXBwbGljYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YW5kYXJkaXplQXBpRXJyb3JSZXNwb25zZShlcnJvcjogYW55KTogQXBpRXJyb3JSZXNwb25zZSB7XG4gIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGFpbHM6JywgZXJyb3IpO1xuICBcbiAgLy8gSGFuZGxlIE9wZW5BSSBBUEkgZXJyb3JzXG4gIGlmIChlcnJvci5uYW1lID09PSAnT3BlbkFJRXJyb3InIHx8IChlcnJvci5yZXNwb25zZSAmJiBlcnJvci5yZXNwb25zZS5oZWFkZXJzICYmIGVycm9yLnJlc3BvbnNlLmhlYWRlcnMuZ2V0KCd4LXJlcXVlc3QtaWQnKSkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IHtcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0IHdpdGggdGhlIGxhbmd1YWdlIG1vZGVsJyxcbiAgICAgICAgY29kZTogJ09QRU5BSV9BUElfRVJST1InLFxuICAgICAgICBkZXRhaWxzOiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nID8ge1xuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgdHlwZTogZXJyb3IudHlwZSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnJvci5zdGF0dXMgfHwgZXJyb3Iuc3RhdHVzQ29kZVxuICAgICAgICB9IDogdW5kZWZpbmVkXG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBcbiAgLy8gSGFuZGxlIHZlY3RvciBzdG9yZSBlcnJvcnNcbiAgaWYgKGVycm9yLm1lc3NhZ2UgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygndmVjdG9yIHN0b3JlJykpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IHtcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIHJldHJpZXZpbmcgaW5mb3JtYXRpb24gZnJvbSBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgIGNvZGU6ICdWRUNUT1JfU1RPUkVfRVJST1InLFxuICAgICAgICBkZXRhaWxzOiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nID8ge1xuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgfSA6IHVuZGVmaW5lZFxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgXG4gIC8vIEhhbmRsZSB0aW1lb3V0IGVycm9yc1xuICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InIHx8IGVycm9yLmNvZGUgPT09ICdFVElNRURPVVQnIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCd0aW1lb3V0JykpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IHtcbiAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgdGltZWQgb3V0LiBQbGVhc2UgdHJ5IGFnYWluLicsXG4gICAgICAgIGNvZGU6ICdUSU1FT1VUX0VSUk9SJyxcbiAgICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyA/IHtcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgICAgIH0gOiB1bmRlZmluZWRcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIFxuICAvLyBEZWZhdWx0IGVycm9yIHJlc3BvbnNlXG4gIHJldHVybiB7XG4gICAgZXJyb3I6IHtcbiAgICAgIG1lc3NhZ2U6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIGNvZGU6ICdJTlRFUk5BTF9TRVJWRVJfRVJST1InLFxuICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyA/IHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcidcbiAgICAgIH0gOiB1bmRlZmluZWRcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICogRm9ybWF0IHZhbGlkYXRpb24gZXJyb3JzIGNvbnNpc3RlbnRseVxuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0VmFsaWRhdGlvbkVycm9yKG1lc3NhZ2U6IHN0cmluZywgZmllbGRFcnJvcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogQXBpRXJyb3JSZXNwb25zZSB7XG4gIHJldHVybiB7XG4gICAgZXJyb3I6IHtcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgZGV0YWlsczogZmllbGRFcnJvcnNcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICogTG9nIGVycm9yIHdpdGggc3RhbmRhcmRpemVkIGZvcm1hdCBmb3IgZWFzaWVyIGRlYnVnZ2luZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gbG9nRXJyb3IoZXJyb3I6IGFueSwgY29udGV4dD86IHN0cmluZyk6IHZvaWQge1xuICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIGNvbnN0IGNvbnRleHRJbmZvID0gY29udGV4dCA/IGBbJHtjb250ZXh0fV0gYCA6ICcnO1xuICBcbiAgY29uc29sZS5lcnJvcihgJHt0aW1lc3RhbXB9ICR7Y29udGV4dEluZm99RXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgXG4gIGlmIChlcnJvci5zdGFjayAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgY29uc29sZS5lcnJvcihgU3RhY2sgdHJhY2U6ICR7ZXJyb3Iuc3RhY2t9YCk7XG4gIH1cbiAgXG4gIC8vIExvZyBhZGRpdGlvbmFsIGRldGFpbHMgaWYgYXZhaWxhYmxlXG4gIGlmIChlcnJvci5yZXNwb25zZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Jlc3BvbnNlIGRhdGE6JywgZXJyb3IucmVzcG9uc2UuZGF0YSk7XG4gICAgY29uc29sZS5lcnJvcignUmVzcG9uc2Ugc3RhdHVzOicsIGVycm9yLnJlc3BvbnNlLnN0YXR1cyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBzaW1wbGUgZXJyb3Igd2l0aCBhZGRpdGlvbmFsIGNvbnRleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVycm9yKG1lc3NhZ2U6IHN0cmluZywgY29kZT86IHN0cmluZywgYWRkaXRpb25hbERldGFpbHM/OiBhbnkpOiBFcnJvciB7XG4gIGNvbnN0IGVycm9yOiBhbnkgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIGlmIChjb2RlKSBlcnJvci5jb2RlID0gY29kZTtcbiAgaWYgKGFkZGl0aW9uYWxEZXRhaWxzKSBlcnJvci5kZXRhaWxzID0gYWRkaXRpb25hbERldGFpbHM7XG4gIHJldHVybiBlcnJvcjtcbn0gIl0sIm5hbWVzIjpbIk9wZW5BSSIsIkRvY3VtZW50UHJvY2Vzc2luZ0Vycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJvcmlnaW5hbEVycm9yIiwibmFtZSIsIkFJTW9kZWxFcnJvciIsIlZlY3RvclN0b3JlRXJyb3IiLCJOZXR3b3JrRXJyb3IiLCJRdWVyeVByb2Nlc3NpbmdFcnJvciIsImhhbmRsZU9wZW5BSUVycm9yIiwiZXJyb3IiLCJBUElFcnJvciIsInN0YXR1cyIsIlN0cmluZyIsInVuZGVmaW5lZCIsImhhbmRsZUVycm9yIiwiY29udGV4dCIsImNvbnNvbGUiLCJjcmVhdGVGYWxsYmFja1Jlc3BvbnNlIiwiZGVmYXVsdFZhbHVlIiwic2FmZUV4ZWN1dGUiLCJvcGVyYXRpb24iLCJmYWxsYmFjayIsInN0YW5kYXJkaXplQXBpRXJyb3JSZXNwb25zZSIsInJlc3BvbnNlIiwiaGVhZGVycyIsImdldCIsImNvZGUiLCJkZXRhaWxzIiwicHJvY2VzcyIsInR5cGUiLCJzdGF0dXNDb2RlIiwiaW5jbHVkZXMiLCJmb3JtYXRWYWxpZGF0aW9uRXJyb3IiLCJmaWVsZEVycm9ycyIsImxvZ0Vycm9yIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiY29udGV4dEluZm8iLCJzdGFjayIsImRhdGEiLCJjcmVhdGVFcnJvciIsImFkZGl0aW9uYWxEZXRhaWxzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./utils/errorHandling.ts\n");

/***/ }),

/***/ "(api)/./utils/vectorStore.ts":
/*!******************************!*\
  !*** ./utils/vectorStore.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addToVectorStore: () => (/* binding */ addToVectorStore),\n/* harmony export */   clearVectorStore: () => (/* binding */ clearVectorStore),\n/* harmony export */   cosineSimilarity: () => (/* binding */ cosineSimilarity),\n/* harmony export */   getAllVectorStoreItems: () => (/* binding */ getAllVectorStoreItems),\n/* harmony export */   getSimilarItems: () => (/* binding */ getSimilarItems),\n/* harmony export */   getVectorStoreSize: () => (/* binding */ getVectorStoreSize),\n/* harmony export */   vectorStore: () => (/* binding */ vectorStore)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Constants for batch processing\nconst VECTOR_STORE_DIR = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"vector_batches\");\nconst BATCH_INDEX_FILE = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"batch_index.json\");\nconst MAX_BATCH_SIZE = 1000; // Maximum items per batch file\n// In-memory vector store (now loads from multiple files)\nlet vectorStore = [];\nlet activeBatches = [];\n// Initialize vector store directory\nfunction initVectorStore() {\n    // Ensure data directory exists\n    const dataDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\");\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(dataDir)) {\n        fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(dataDir, {\n            recursive: true\n        });\n    }\n    // Ensure vector_batches directory exists\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(VECTOR_STORE_DIR)) {\n        fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(VECTOR_STORE_DIR, {\n            recursive: true\n        });\n    }\n    // Create batch index if it doesn't exist\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(BATCH_INDEX_FILE)) {\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(BATCH_INDEX_FILE, JSON.stringify({\n            activeBatches: [],\n            lastUpdated: Date.now()\n        }));\n    }\n}\n// Load vector store index and all active batches\nfunction loadVectorStore() {\n    try {\n        initVectorStore();\n        console.log(\"Loading vector store batches...\");\n        // Read the batch index\n        const indexData = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(BATCH_INDEX_FILE, \"utf-8\"));\n        activeBatches = indexData.activeBatches || [];\n        // Load each active batch\n        vectorStore = [];\n        let totalLoaded = 0;\n        for (const batchId of activeBatches){\n            const batchFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(VECTOR_STORE_DIR, `batch_${batchId}.json`);\n            if (fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(batchFile)) {\n                try {\n                    const batchData = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(batchFile, \"utf-8\"));\n                    vectorStore = [\n                        ...vectorStore,\n                        ...batchData\n                    ];\n                    totalLoaded += batchData.length;\n                    console.log(`Loaded batch ${batchId} with ${batchData.length} items`);\n                } catch (error) {\n                    console.error(`Error loading batch ${batchId}:`, error);\n                }\n            }\n        }\n        // If no batches were loaded, try loading from single vectorStore.json file as fallback\n        if (totalLoaded === 0) {\n            const singleStoreFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"vectorStore.json\");\n            if (fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(singleStoreFile)) {\n                try {\n                    const fileData = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(singleStoreFile, \"utf8\");\n                    const parsedData = JSON.parse(fileData);\n                    // Handle both formats: array of items or {items: [...]} structure\n                    if (Array.isArray(parsedData)) {\n                        vectorStore = parsedData;\n                        totalLoaded = parsedData.length;\n                    } else if (parsedData.items && Array.isArray(parsedData.items)) {\n                        vectorStore = parsedData.items;\n                        totalLoaded = parsedData.items.length;\n                    }\n                    console.log(`Loaded ${totalLoaded} items from single vectorStore.json file`);\n                } catch (error) {\n                    console.error(\"Error loading from single vectorStore.json file:\", error);\n                }\n            }\n        }\n        console.log(`Loaded ${totalLoaded} total items from ${activeBatches.length} batches and fallback sources`);\n    } catch (error) {\n        console.error(\"Error loading vector store:\", error);\n        vectorStore = [];\n        activeBatches = [];\n    }\n}\n// Create a new batch and add it to the index\nfunction createNewBatch() {\n    const batchId = Date.now().toString();\n    activeBatches.push(batchId);\n    // Update the batch index\n    fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(BATCH_INDEX_FILE, JSON.stringify({\n        activeBatches,\n        lastUpdated: Date.now()\n    }, null, 2));\n    console.log(`Created new batch: ${batchId}`);\n    return batchId;\n}\n// Save a specific batch to disk\nfunction saveBatch(batchId, items) {\n    const batchFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(VECTOR_STORE_DIR, `batch_${batchId}.json`);\n    fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(batchFile, JSON.stringify(items, null, 2));\n    console.log(`Saved batch ${batchId} with ${items.length} items`);\n}\n// Save the current state of all batches\nfunction saveVectorStore() {\n    try {\n        if (activeBatches.length === 0 && vectorStore.length > 0) {\n            // First-time save - create initial batch\n            const initialBatchId = createNewBatch();\n            // Add batch metadata to all items\n            vectorStore = vectorStore.map((item)=>({\n                    ...item,\n                    metadata: {\n                        ...item.metadata,\n                        batch: initialBatchId\n                    }\n                }));\n            // Save as first batch\n            saveBatch(initialBatchId, vectorStore);\n        } else {\n            // Group items by batch\n            const batchMap = {};\n            // Find items without batch ID (newly added)\n            const unbatchedItems = vectorStore.filter((item)=>!item.metadata?.batch);\n            if (unbatchedItems.length > 0) {\n                // Get current batch or create new one\n                let currentBatchId = activeBatches[activeBatches.length - 1];\n                if (currentBatchId) {\n                    // Count items in the current batch\n                    const currentBatchCount = vectorStore.filter((item)=>item.metadata?.batch === currentBatchId).length;\n                    // Create a new batch if current one is too full\n                    if (currentBatchCount + unbatchedItems.length > MAX_BATCH_SIZE) {\n                        currentBatchId = createNewBatch();\n                    }\n                } else {\n                    // No batches exist yet, create the first one\n                    currentBatchId = createNewBatch();\n                }\n                // Assign batch ID to unbatched items\n                unbatchedItems.forEach((item)=>{\n                    if (!item.metadata) item.metadata = {};\n                    item.metadata.batch = currentBatchId;\n                });\n            }\n            // Group all items by batch\n            vectorStore.forEach((item)=>{\n                const batchId = item.metadata?.batch;\n                if (batchId) {\n                    if (!batchMap[batchId]) batchMap[batchId] = [];\n                    batchMap[batchId].push(item);\n                }\n            });\n            // Save each batch\n            Object.entries(batchMap).forEach(([batchId, items])=>{\n                if (items.length > 0) {\n                    saveBatch(batchId, items);\n                }\n            });\n        }\n        // Update index file\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(BATCH_INDEX_FILE, JSON.stringify({\n            activeBatches,\n            lastUpdated: Date.now()\n        }, null, 2));\n        // Also save to the single vectorStore.json file as a backup\n        const singleStoreFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"vectorStore.json\");\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(singleStoreFile, JSON.stringify({\n            items: vectorStore,\n            lastUpdated: Date.now()\n        }, null, 2));\n        console.log(`Saved vector store with ${activeBatches.length} batches and ${vectorStore.length} total items`);\n    } catch (error) {\n        console.error(\"Error saving vector store:\", error);\n    }\n}\n/**\n * Calculate cosine similarity between two vectors\n * @param vecA First vector\n * @param vecB Second vector\n * @returns Cosine similarity score (0-1)\n */ function cosineSimilarity(vecA, vecB) {\n    const dot = vecA.reduce((sum, a, i)=>sum + a * vecB[i], 0);\n    const magA = Math.sqrt(vecA.reduce((sum, a)=>sum + a * a, 0));\n    const magB = Math.sqrt(vecB.reduce((sum, b)=>sum + b * b, 0));\n    return dot / (magA * magB);\n}\n/**\n * Add an item or multiple items to the vector store\n * @param items Single item or array of items to add\n */ function addToVectorStore(items) {\n    // Convert single item to array\n    const itemsArray = Array.isArray(items) ? items : [\n        items\n    ];\n    if (itemsArray.length === 0) return;\n    // Add to in-memory store\n    vectorStore = [\n        ...vectorStore,\n        ...itemsArray\n    ];\n    // Save changes to disk\n    saveVectorStore();\n}\n// Enhanced version of getSimilarItems with stronger emphasis on structured data\nfunction getSimilarItems(queryEmbedding, limit = 5, queryText, priorityInfoType) {\n    // Check if the vector store is initialized\n    if (!vectorStore || vectorStore.length === 0) {\n        loadVectorStore();\n    }\n    if (!vectorStore || vectorStore.length === 0) {\n        console.warn(\"Vector store is empty. No results to return.\");\n        return [];\n    }\n    console.log(\"Searching for similar items...\");\n    // Look for certain types of inquiries to boost specific content\n    let shouldBoostStructuredInfo = false;\n    let shouldBoostCompanyValues = false;\n    let shouldBoostInvestors = false;\n    let shouldBoostLeadership = false;\n    let shouldBoostPricing = false;\n    let shouldBoostProductFeatures = false;\n    let shouldBoostSalesInfo = false;\n    if (queryText) {\n        const queryLower = queryText.toLowerCase();\n        // Check for company values inquiries\n        shouldBoostCompanyValues = queryLower.includes(\"value\") || queryLower.includes(\"culture\") || queryLower.includes(\"principle\") || queryLower.includes(\"mission\") || queryLower.includes(\"vision\");\n        // Check for investor inquiries\n        shouldBoostInvestors = queryLower.includes(\"investor\") || queryLower.includes(\"funding\") || queryLower.includes(\"backed by\") || queryLower.includes(\"invested\");\n        // Check for leadership inquiries\n        shouldBoostLeadership = queryLower.includes(\"founder\") || queryLower.includes(\"ceo\") || queryLower.includes(\"leader\") || queryLower.includes(\"executive\");\n        // Check for pricing inquiries\n        shouldBoostPricing = queryLower.includes(\"pricing\") || queryLower.includes(\"price\") || queryLower.includes(\"cost\") || queryLower.includes(\"subscription\") || queryLower.includes(\"plan\") || queryLower.includes(\"tier\");\n        // Check for product feature inquiries  \n        shouldBoostProductFeatures = queryLower.includes(\"feature\") || queryLower.includes(\"function\") || queryLower.includes(\"capability\") || queryLower.includes(\"how does it work\") || queryLower.includes(\"what does it do\");\n        // Check for sales information inquiries\n        shouldBoostSalesInfo = queryLower.includes(\"sell\") || queryLower.includes(\"pitch\") || queryLower.includes(\"competitor\") || queryLower.includes(\"comparison\");\n        // Set the overall structured info flag if any specific type should be boosted\n        shouldBoostStructuredInfo = shouldBoostCompanyValues || shouldBoostInvestors || shouldBoostLeadership || shouldBoostPricing || shouldBoostProductFeatures || shouldBoostSalesInfo;\n    }\n    // Calculate similarity scores\n    const itemsWithScores = vectorStore.map((item)=>{\n        // Compute base score using cosine similarity\n        let score = cosineSimilarity(queryEmbedding, item.embedding);\n        // Apply boosting for structured information when relevant\n        if (shouldBoostStructuredInfo && item.metadata?.isStructured) {\n            // Specific boosts for different types of structured information\n            const infoType = item.metadata?.infoType;\n            // Handle the case when a specific info type is prioritized\n            if (priorityInfoType && infoType === priorityInfoType) {\n                score *= 1.5; // Strong boost for exact info type match\n            } else if (shouldBoostCompanyValues && infoType === \"company_values\") {\n                score *= 1.3;\n            } else if (shouldBoostInvestors && infoType === \"investors\") {\n                score *= 1.3;\n            } else if (shouldBoostLeadership && infoType === \"leadership\") {\n                score *= 1.3;\n            } else if (shouldBoostPricing && infoType === \"pricing\") {\n                score *= 1.3;\n            } else if (shouldBoostProductFeatures && infoType === \"product_features\") {\n                score *= 1.3;\n            } else if (shouldBoostSalesInfo && infoType === \"sales_info\") {\n                score *= 1.3;\n            } else if (item.metadata?.isStructured) {\n                // General boost for any structured info\n                score *= 1.1;\n            }\n        }\n        return {\n            ...item,\n            score\n        };\n    });\n    // Sort by similarity score\n    const sortedResults = itemsWithScores.sort((a, b)=>b.score - a.score);\n    // Get the top results, but ensure priority structured info is included if relevant\n    let result = sortedResults.slice(0, limit);\n    // Check if we need to guarantee inclusion of specific structured info\n    if (shouldBoostStructuredInfo) {\n        // Check if we already have a relevant piece of structured information\n        let hasRelevantStructuredInfo = false;\n        // Use the priorityInfoType if available, otherwise check all relevant types\n        if (priorityInfoType) {\n            hasRelevantStructuredInfo = result.some((item)=>item.metadata?.infoType === priorityInfoType);\n        } else {\n            hasRelevantStructuredInfo = result.some((item)=>{\n                const infoType = item.metadata?.infoType;\n                return shouldBoostCompanyValues && infoType === \"company_values\" || shouldBoostInvestors && infoType === \"investors\" || shouldBoostLeadership && infoType === \"leadership\" || shouldBoostPricing && infoType === \"pricing\" || shouldBoostProductFeatures && infoType === \"product_features\" || shouldBoostSalesInfo && infoType === \"sales_info\";\n            });\n        }\n        // If we don't have the relevant info in our top results, find and include it\n        if (!hasRelevantStructuredInfo) {\n            let structuredInfoToInclude;\n            if (priorityInfoType) {\n                // Look for the specific priority info type\n                structuredInfoToInclude = sortedResults.find((item)=>item.metadata?.infoType === priorityInfoType && !result.includes(item));\n            } else {\n                // Look for any relevant structured info type\n                structuredInfoToInclude = sortedResults.find((item)=>{\n                    const infoType = item.metadata?.infoType;\n                    return (shouldBoostCompanyValues && infoType === \"company_values\" || shouldBoostInvestors && infoType === \"investors\" || shouldBoostLeadership && infoType === \"leadership\" || shouldBoostPricing && infoType === \"pricing\" || shouldBoostProductFeatures && infoType === \"product_features\" || shouldBoostSalesInfo && infoType === \"sales_info\") && !result.includes(item);\n                });\n            }\n            // If we found a relevant item, add it and remove the lowest scored item\n            if (structuredInfoToInclude) {\n                result.pop(); // Remove the lowest scored item\n                result.push(structuredInfoToInclude);\n                // Re-sort to maintain score order\n                result = result.sort((a, b)=>b.score - a.score);\n            }\n        }\n    }\n    return result;\n}\n/**\n * Clear the vector store\n */ function clearVectorStore() {\n    // Clear in-memory data\n    vectorStore = [];\n    // Delete all batch files\n    try {\n        if (fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(VECTOR_STORE_DIR)) {\n            const files = fs__WEBPACK_IMPORTED_MODULE_0___default().readdirSync(VECTOR_STORE_DIR);\n            files.forEach((file)=>{\n                if (file.startsWith(\"batch_\")) {\n                    fs__WEBPACK_IMPORTED_MODULE_0___default().unlinkSync(path__WEBPACK_IMPORTED_MODULE_1___default().join(VECTOR_STORE_DIR, file));\n                }\n            });\n        }\n        // Reset batch index\n        activeBatches = [];\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(BATCH_INDEX_FILE, JSON.stringify({\n            activeBatches: [],\n            lastUpdated: Date.now()\n        }, null, 2));\n        console.log(\"Vector store cleared successfully\");\n    } catch (error) {\n        console.error(\"Error clearing vector store:\", error);\n    }\n}\n/**\n * Get the current size of the vector store\n * @returns Number of items in the vector store\n */ function getVectorStoreSize() {\n    return vectorStore.length;\n}\n// Initialize vector store on module load\ntry {\n    loadVectorStore();\n} catch (error) {\n    console.error(\"Failed to initialize vector store:\", error);\n    vectorStore = [];\n    activeBatches = [];\n}\n/**\n * Get all items from the vector store\n * @returns Array of all vector store items\n */ function getAllVectorStoreItems() {\n    return [\n        ...vectorStore\n    ];\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxDQUFDL0IsR0FBR00sSUFBTUEsRUFBRW9CLEtBQUssR0FBRzFCLEVBQUUwQixLQUFLO1lBQ2xEO1FBQ0Y7SUFDRjtJQUVBLE9BQU9NO0FBQ1Q7QUFFQTs7Q0FFQyxHQUNNLFNBQVNPO0lBQ2QsdUJBQXVCO0lBQ3ZCOUYsY0FBYyxFQUFFO0lBRWhCLHlCQUF5QjtJQUN6QixJQUFJO1FBQ0YsSUFBSVIsb0RBQWEsQ0FBQ0UsbUJBQW1CO1lBQ25DLE1BQU1xRyxRQUFRdkcscURBQWMsQ0FBQ0U7WUFDN0JxRyxNQUFNakQsT0FBTyxDQUFDbUQsQ0FBQUE7Z0JBQ1osSUFBSUEsS0FBS0MsVUFBVSxDQUFDLFdBQVc7b0JBQzdCMUcsb0RBQWEsQ0FBQ0MsZ0RBQVMsQ0FBQ0Msa0JBQWtCdUc7Z0JBQzVDO1lBQ0Y7UUFDRjtRQUVBLG9CQUFvQjtRQUNwQmhHLGdCQUFnQixFQUFFO1FBQ2xCVCx1REFBZ0IsQ0FBQ00sa0JBQWtCVSxLQUFLQyxTQUFTLENBQUM7WUFDaERSLGVBQWUsRUFBRTtZQUNqQlMsYUFBYUMsS0FBS0MsR0FBRztRQUN2QixHQUFHLE1BQU07UUFFVEUsUUFBUUMsR0FBRyxDQUFDO0lBQ2QsRUFBRSxPQUFPUyxPQUFPO1FBQ2RWLFFBQVFVLEtBQUssQ0FBQyxnQ0FBZ0NBO0lBQ2hEO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxTQUFTNEU7SUFDZCxPQUFPcEcsWUFBWXVCLE1BQU07QUFDM0I7QUFFQSx5Q0FBeUM7QUFDekMsSUFBSTtJQUNGVjtBQUNGLEVBQUUsT0FBT1csT0FBTztJQUNkVixRQUFRVSxLQUFLLENBQUMsc0NBQXNDQTtJQUNwRHhCLGNBQWMsRUFBRTtJQUNoQkMsZ0JBQWdCLEVBQUU7QUFDcEI7QUFFQTs7O0NBR0MsR0FDTSxTQUFTb0c7SUFDZCxPQUFPO1dBQUlyRztLQUFZO0FBQ3pCO0FBRXVCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2FsZXMtY2hhdC1vcGVuYWktcmFnLy4vdXRpbHMvdmVjdG9yU3RvcmUudHM/NTU2OSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgaW50ZXJmYWNlIFZlY3RvclN0b3JlSXRlbSB7XG4gIGVtYmVkZGluZzogbnVtYmVyW107XG4gIHRleHQ6IHN0cmluZztcbiAgbWV0YWRhdGE/OiB7XG4gICAgc291cmNlPzogc3RyaW5nO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgYmF0Y2g/OiBzdHJpbmc7XG4gICAgaXNTdHJ1Y3R1cmVkPzogYm9vbGVhbjtcbiAgICBpbmZvVHlwZT86IHN0cmluZztcbiAgICBwcmlvcml0eT86IHN0cmluZztcbiAgfTtcbn1cblxuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG4vLyBDb25zdGFudHMgZm9yIGJhdGNoIHByb2Nlc3NpbmdcbmNvbnN0IFZFQ1RPUl9TVE9SRV9ESVIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAndmVjdG9yX2JhdGNoZXMnKTtcbmNvbnN0IEJBVENIX0lOREVYX0ZJTEUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAnYmF0Y2hfaW5kZXguanNvbicpO1xuY29uc3QgTUFYX0JBVENIX1NJWkUgPSAxMDAwOyAvLyBNYXhpbXVtIGl0ZW1zIHBlciBiYXRjaCBmaWxlXG5cbi8vIEluLW1lbW9yeSB2ZWN0b3Igc3RvcmUgKG5vdyBsb2FkcyBmcm9tIG11bHRpcGxlIGZpbGVzKVxubGV0IHZlY3RvclN0b3JlOiBWZWN0b3JTdG9yZUl0ZW1bXSA9IFtdO1xubGV0IGFjdGl2ZUJhdGNoZXM6IHN0cmluZ1tdID0gW107XG5cbi8vIEluaXRpYWxpemUgdmVjdG9yIHN0b3JlIGRpcmVjdG9yeVxuZnVuY3Rpb24gaW5pdFZlY3RvclN0b3JlKCkge1xuICAvLyBFbnN1cmUgZGF0YSBkaXJlY3RvcnkgZXhpc3RzXG4gIGNvbnN0IGRhdGFEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnKTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRhdGFEaXIpKSB7XG4gICAgZnMubWtkaXJTeW5jKGRhdGFEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICB9XG4gIFxuICAvLyBFbnN1cmUgdmVjdG9yX2JhdGNoZXMgZGlyZWN0b3J5IGV4aXN0c1xuICBpZiAoIWZzLmV4aXN0c1N5bmMoVkVDVE9SX1NUT1JFX0RJUikpIHtcbiAgICBmcy5ta2RpclN5bmMoVkVDVE9SX1NUT1JFX0RJUiwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIH1cbiAgXG4gIC8vIENyZWF0ZSBiYXRjaCBpbmRleCBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gIGlmICghZnMuZXhpc3RzU3luYyhCQVRDSF9JTkRFWF9GSUxFKSkge1xuICAgIGZzLndyaXRlRmlsZVN5bmMoQkFUQ0hfSU5ERVhfRklMRSwgSlNPTi5zdHJpbmdpZnkoeyBcbiAgICAgIGFjdGl2ZUJhdGNoZXM6IFtdLFxuICAgICAgbGFzdFVwZGF0ZWQ6IERhdGUubm93KCkgXG4gICAgfSkpO1xuICB9XG59XG5cbi8vIExvYWQgdmVjdG9yIHN0b3JlIGluZGV4IGFuZCBhbGwgYWN0aXZlIGJhdGNoZXNcbmZ1bmN0aW9uIGxvYWRWZWN0b3JTdG9yZSgpIHtcbiAgdHJ5IHtcbiAgICBpbml0VmVjdG9yU3RvcmUoKTtcbiAgICBjb25zb2xlLmxvZygnTG9hZGluZyB2ZWN0b3Igc3RvcmUgYmF0Y2hlcy4uLicpO1xuICAgIFxuICAgIC8vIFJlYWQgdGhlIGJhdGNoIGluZGV4XG4gICAgY29uc3QgaW5kZXhEYXRhID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoQkFUQ0hfSU5ERVhfRklMRSwgJ3V0Zi04JykpO1xuICAgIGFjdGl2ZUJhdGNoZXMgPSBpbmRleERhdGEuYWN0aXZlQmF0Y2hlcyB8fCBbXTtcbiAgICBcbiAgICAvLyBMb2FkIGVhY2ggYWN0aXZlIGJhdGNoXG4gICAgdmVjdG9yU3RvcmUgPSBbXTtcbiAgICBsZXQgdG90YWxMb2FkZWQgPSAwO1xuICAgIFxuICAgIGZvciAoY29uc3QgYmF0Y2hJZCBvZiBhY3RpdmVCYXRjaGVzKSB7XG4gICAgICBjb25zdCBiYXRjaEZpbGUgPSBwYXRoLmpvaW4oVkVDVE9SX1NUT1JFX0RJUiwgYGJhdGNoXyR7YmF0Y2hJZH0uanNvbmApO1xuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoYmF0Y2hGaWxlKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGJhdGNoRGF0YSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGJhdGNoRmlsZSwgJ3V0Zi04JykpO1xuICAgICAgICAgIHZlY3RvclN0b3JlID0gWy4uLnZlY3RvclN0b3JlLCAuLi5iYXRjaERhdGFdO1xuICAgICAgICAgIHRvdGFsTG9hZGVkICs9IGJhdGNoRGF0YS5sZW5ndGg7XG4gICAgICAgICAgY29uc29sZS5sb2coYExvYWRlZCBiYXRjaCAke2JhdGNoSWR9IHdpdGggJHtiYXRjaERhdGEubGVuZ3RofSBpdGVtc2ApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGxvYWRpbmcgYmF0Y2ggJHtiYXRjaElkfTpgLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSWYgbm8gYmF0Y2hlcyB3ZXJlIGxvYWRlZCwgdHJ5IGxvYWRpbmcgZnJvbSBzaW5nbGUgdmVjdG9yU3RvcmUuanNvbiBmaWxlIGFzIGZhbGxiYWNrXG4gICAgaWYgKHRvdGFsTG9hZGVkID09PSAwKSB7XG4gICAgICBjb25zdCBzaW5nbGVTdG9yZUZpbGUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAndmVjdG9yU3RvcmUuanNvbicpO1xuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoc2luZ2xlU3RvcmVGaWxlKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZpbGVEYXRhID0gZnMucmVhZEZpbGVTeW5jKHNpbmdsZVN0b3JlRmlsZSwgJ3V0ZjgnKTtcbiAgICAgICAgICBjb25zdCBwYXJzZWREYXRhID0gSlNPTi5wYXJzZShmaWxlRGF0YSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSGFuZGxlIGJvdGggZm9ybWF0czogYXJyYXkgb2YgaXRlbXMgb3Ige2l0ZW1zOiBbLi4uXX0gc3RydWN0dXJlXG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkRGF0YSkpIHtcbiAgICAgICAgICAgIHZlY3RvclN0b3JlID0gcGFyc2VkRGF0YTtcbiAgICAgICAgICAgIHRvdGFsTG9hZGVkID0gcGFyc2VkRGF0YS5sZW5ndGg7XG4gICAgICAgICAgfSBlbHNlIGlmIChwYXJzZWREYXRhLml0ZW1zICYmIEFycmF5LmlzQXJyYXkocGFyc2VkRGF0YS5pdGVtcykpIHtcbiAgICAgICAgICAgIHZlY3RvclN0b3JlID0gcGFyc2VkRGF0YS5pdGVtcztcbiAgICAgICAgICAgIHRvdGFsTG9hZGVkID0gcGFyc2VkRGF0YS5pdGVtcy5sZW5ndGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHt0b3RhbExvYWRlZH0gaXRlbXMgZnJvbSBzaW5nbGUgdmVjdG9yU3RvcmUuanNvbiBmaWxlYCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBmcm9tIHNpbmdsZSB2ZWN0b3JTdG9yZS5qc29uIGZpbGU6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHt0b3RhbExvYWRlZH0gdG90YWwgaXRlbXMgZnJvbSAke2FjdGl2ZUJhdGNoZXMubGVuZ3RofSBiYXRjaGVzIGFuZCBmYWxsYmFjayBzb3VyY2VzYCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyB2ZWN0b3Igc3RvcmU6JywgZXJyb3IpO1xuICAgIHZlY3RvclN0b3JlID0gW107XG4gICAgYWN0aXZlQmF0Y2hlcyA9IFtdO1xuICB9XG59XG5cbi8vIENyZWF0ZSBhIG5ldyBiYXRjaCBhbmQgYWRkIGl0IHRvIHRoZSBpbmRleFxuZnVuY3Rpb24gY3JlYXRlTmV3QmF0Y2goKTogc3RyaW5nIHtcbiAgY29uc3QgYmF0Y2hJZCA9IERhdGUubm93KCkudG9TdHJpbmcoKTtcbiAgYWN0aXZlQmF0Y2hlcy5wdXNoKGJhdGNoSWQpO1xuICBcbiAgLy8gVXBkYXRlIHRoZSBiYXRjaCBpbmRleFxuICBmcy53cml0ZUZpbGVTeW5jKEJBVENIX0lOREVYX0ZJTEUsIEpTT04uc3RyaW5naWZ5KHtcbiAgICBhY3RpdmVCYXRjaGVzLFxuICAgIGxhc3RVcGRhdGVkOiBEYXRlLm5vdygpXG4gIH0sIG51bGwsIDIpKTtcbiAgXG4gIGNvbnNvbGUubG9nKGBDcmVhdGVkIG5ldyBiYXRjaDogJHtiYXRjaElkfWApO1xuICByZXR1cm4gYmF0Y2hJZDtcbn1cblxuLy8gU2F2ZSBhIHNwZWNpZmljIGJhdGNoIHRvIGRpc2tcbmZ1bmN0aW9uIHNhdmVCYXRjaChiYXRjaElkOiBzdHJpbmcsIGl0ZW1zOiBWZWN0b3JTdG9yZUl0ZW1bXSkge1xuICBjb25zdCBiYXRjaEZpbGUgPSBwYXRoLmpvaW4oVkVDVE9SX1NUT1JFX0RJUiwgYGJhdGNoXyR7YmF0Y2hJZH0uanNvbmApO1xuICBmcy53cml0ZUZpbGVTeW5jKGJhdGNoRmlsZSwgSlNPTi5zdHJpbmdpZnkoaXRlbXMsIG51bGwsIDIpKTtcbiAgY29uc29sZS5sb2coYFNhdmVkIGJhdGNoICR7YmF0Y2hJZH0gd2l0aCAke2l0ZW1zLmxlbmd0aH0gaXRlbXNgKTtcbn1cblxuLy8gU2F2ZSB0aGUgY3VycmVudCBzdGF0ZSBvZiBhbGwgYmF0Y2hlc1xuZnVuY3Rpb24gc2F2ZVZlY3RvclN0b3JlKCkge1xuICB0cnkge1xuICAgIGlmIChhY3RpdmVCYXRjaGVzLmxlbmd0aCA9PT0gMCAmJiB2ZWN0b3JTdG9yZS5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBGaXJzdC10aW1lIHNhdmUgLSBjcmVhdGUgaW5pdGlhbCBiYXRjaFxuICAgICAgY29uc3QgaW5pdGlhbEJhdGNoSWQgPSBjcmVhdGVOZXdCYXRjaCgpO1xuICAgICAgXG4gICAgICAvLyBBZGQgYmF0Y2ggbWV0YWRhdGEgdG8gYWxsIGl0ZW1zXG4gICAgICB2ZWN0b3JTdG9yZSA9IHZlY3RvclN0b3JlLm1hcChpdGVtID0+ICh7XG4gICAgICAgIC4uLml0ZW0sXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgLi4uaXRlbS5tZXRhZGF0YSxcbiAgICAgICAgICBiYXRjaDogaW5pdGlhbEJhdGNoSWRcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICAvLyBTYXZlIGFzIGZpcnN0IGJhdGNoXG4gICAgICBzYXZlQmF0Y2goaW5pdGlhbEJhdGNoSWQsIHZlY3RvclN0b3JlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gR3JvdXAgaXRlbXMgYnkgYmF0Y2hcbiAgICAgIGNvbnN0IGJhdGNoTWFwOiBSZWNvcmQ8c3RyaW5nLCBWZWN0b3JTdG9yZUl0ZW1bXT4gPSB7fTtcbiAgICAgIFxuICAgICAgLy8gRmluZCBpdGVtcyB3aXRob3V0IGJhdGNoIElEIChuZXdseSBhZGRlZClcbiAgICAgIGNvbnN0IHVuYmF0Y2hlZEl0ZW1zID0gdmVjdG9yU3RvcmUuZmlsdGVyKGl0ZW0gPT4gIWl0ZW0ubWV0YWRhdGE/LmJhdGNoKTtcbiAgICAgIFxuICAgICAgaWYgKHVuYmF0Y2hlZEl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgYmF0Y2ggb3IgY3JlYXRlIG5ldyBvbmVcbiAgICAgICAgbGV0IGN1cnJlbnRCYXRjaElkID0gYWN0aXZlQmF0Y2hlc1thY3RpdmVCYXRjaGVzLmxlbmd0aCAtIDFdO1xuICAgICAgICBcbiAgICAgICAgaWYgKGN1cnJlbnRCYXRjaElkKSB7XG4gICAgICAgICAgLy8gQ291bnQgaXRlbXMgaW4gdGhlIGN1cnJlbnQgYmF0Y2hcbiAgICAgICAgICBjb25zdCBjdXJyZW50QmF0Y2hDb3VudCA9IHZlY3RvclN0b3JlLmZpbHRlcihcbiAgICAgICAgICAgIGl0ZW0gPT4gaXRlbS5tZXRhZGF0YT8uYmF0Y2ggPT09IGN1cnJlbnRCYXRjaElkXG4gICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJhdGNoIGlmIGN1cnJlbnQgb25lIGlzIHRvbyBmdWxsXG4gICAgICAgICAgaWYgKGN1cnJlbnRCYXRjaENvdW50ICsgdW5iYXRjaGVkSXRlbXMubGVuZ3RoID4gTUFYX0JBVENIX1NJWkUpIHtcbiAgICAgICAgICAgIGN1cnJlbnRCYXRjaElkID0gY3JlYXRlTmV3QmF0Y2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTm8gYmF0Y2hlcyBleGlzdCB5ZXQsIGNyZWF0ZSB0aGUgZmlyc3Qgb25lXG4gICAgICAgICAgY3VycmVudEJhdGNoSWQgPSBjcmVhdGVOZXdCYXRjaCgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBc3NpZ24gYmF0Y2ggSUQgdG8gdW5iYXRjaGVkIGl0ZW1zXG4gICAgICAgIHVuYmF0Y2hlZEl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgaWYgKCFpdGVtLm1ldGFkYXRhKSBpdGVtLm1ldGFkYXRhID0ge307XG4gICAgICAgICAgaXRlbS5tZXRhZGF0YS5iYXRjaCA9IGN1cnJlbnRCYXRjaElkO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gR3JvdXAgYWxsIGl0ZW1zIGJ5IGJhdGNoXG4gICAgICB2ZWN0b3JTdG9yZS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBjb25zdCBiYXRjaElkID0gaXRlbS5tZXRhZGF0YT8uYmF0Y2g7XG4gICAgICAgIGlmIChiYXRjaElkKSB7XG4gICAgICAgICAgaWYgKCFiYXRjaE1hcFtiYXRjaElkXSkgYmF0Y2hNYXBbYmF0Y2hJZF0gPSBbXTtcbiAgICAgICAgICBiYXRjaE1hcFtiYXRjaElkXS5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gU2F2ZSBlYWNoIGJhdGNoXG4gICAgICBPYmplY3QuZW50cmllcyhiYXRjaE1hcCkuZm9yRWFjaCgoW2JhdGNoSWQsIGl0ZW1zXSkgPT4ge1xuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHNhdmVCYXRjaChiYXRjaElkLCBpdGVtcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgaW5kZXggZmlsZVxuICAgIGZzLndyaXRlRmlsZVN5bmMoQkFUQ0hfSU5ERVhfRklMRSwgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgYWN0aXZlQmF0Y2hlcyxcbiAgICAgIGxhc3RVcGRhdGVkOiBEYXRlLm5vdygpXG4gICAgfSwgbnVsbCwgMikpO1xuICAgIFxuICAgIC8vIEFsc28gc2F2ZSB0byB0aGUgc2luZ2xlIHZlY3RvclN0b3JlLmpzb24gZmlsZSBhcyBhIGJhY2t1cFxuICAgIGNvbnN0IHNpbmdsZVN0b3JlRmlsZSA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICd2ZWN0b3JTdG9yZS5qc29uJyk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhzaW5nbGVTdG9yZUZpbGUsIEpTT04uc3RyaW5naWZ5KHsgXG4gICAgICBpdGVtczogdmVjdG9yU3RvcmUsXG4gICAgICBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKVxuICAgIH0sIG51bGwsIDIpKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgU2F2ZWQgdmVjdG9yIHN0b3JlIHdpdGggJHthY3RpdmVCYXRjaGVzLmxlbmd0aH0gYmF0Y2hlcyBhbmQgJHt2ZWN0b3JTdG9yZS5sZW5ndGh9IHRvdGFsIGl0ZW1zYCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHZlY3RvciBzdG9yZTonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29zaW5lIHNpbWlsYXJpdHkgYmV0d2VlbiB0d28gdmVjdG9yc1xuICogQHBhcmFtIHZlY0EgRmlyc3QgdmVjdG9yXG4gKiBAcGFyYW0gdmVjQiBTZWNvbmQgdmVjdG9yXG4gKiBAcmV0dXJucyBDb3NpbmUgc2ltaWxhcml0eSBzY29yZSAoMC0xKVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29zaW5lU2ltaWxhcml0eSh2ZWNBOiBudW1iZXJbXSwgdmVjQjogbnVtYmVyW10pOiBudW1iZXIge1xuICBjb25zdCBkb3QgPSB2ZWNBLnJlZHVjZSgoc3VtLCBhLCBpKSA9PiBzdW0gKyBhICogdmVjQltpXSwgMCk7XG4gIGNvbnN0IG1hZ0EgPSBNYXRoLnNxcnQodmVjQS5yZWR1Y2UoKHN1bSwgYSkgPT4gc3VtICsgYSAqIGEsIDApKTtcbiAgY29uc3QgbWFnQiA9IE1hdGguc3FydCh2ZWNCLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyBiICogYiwgMCkpO1xuICByZXR1cm4gZG90IC8gKG1hZ0EgKiBtYWdCKTtcbn1cblxuLyoqXG4gKiBBZGQgYW4gaXRlbSBvciBtdWx0aXBsZSBpdGVtcyB0byB0aGUgdmVjdG9yIHN0b3JlXG4gKiBAcGFyYW0gaXRlbXMgU2luZ2xlIGl0ZW0gb3IgYXJyYXkgb2YgaXRlbXMgdG8gYWRkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZGRUb1ZlY3RvclN0b3JlKGl0ZW1zOiBWZWN0b3JTdG9yZUl0ZW0gfCBWZWN0b3JTdG9yZUl0ZW1bXSk6IHZvaWQge1xuICAvLyBDb252ZXJ0IHNpbmdsZSBpdGVtIHRvIGFycmF5XG4gIGNvbnN0IGl0ZW1zQXJyYXkgPSBBcnJheS5pc0FycmF5KGl0ZW1zKSA/IGl0ZW1zIDogW2l0ZW1zXTtcbiAgaWYgKGl0ZW1zQXJyYXkubGVuZ3RoID09PSAwKSByZXR1cm47XG4gIFxuICAvLyBBZGQgdG8gaW4tbWVtb3J5IHN0b3JlXG4gIHZlY3RvclN0b3JlID0gWy4uLnZlY3RvclN0b3JlLCAuLi5pdGVtc0FycmF5XTtcbiAgXG4gIC8vIFNhdmUgY2hhbmdlcyB0byBkaXNrXG4gIHNhdmVWZWN0b3JTdG9yZSgpO1xufVxuXG4vLyBFbmhhbmNlZCB2ZXJzaW9uIG9mIGdldFNpbWlsYXJJdGVtcyB3aXRoIHN0cm9uZ2VyIGVtcGhhc2lzIG9uIHN0cnVjdHVyZWQgZGF0YVxuZXhwb3J0IGZ1bmN0aW9uIGdldFNpbWlsYXJJdGVtcyhcbiAgcXVlcnlFbWJlZGRpbmc6IG51bWJlcltdLFxuICBsaW1pdDogbnVtYmVyID0gNSxcbiAgcXVlcnlUZXh0Pzogc3RyaW5nLFxuICBwcmlvcml0eUluZm9UeXBlPzogc3RyaW5nXG4pOiAoVmVjdG9yU3RvcmVJdGVtICYgeyBzY29yZTogbnVtYmVyIH0pW10ge1xuICAvLyBDaGVjayBpZiB0aGUgdmVjdG9yIHN0b3JlIGlzIGluaXRpYWxpemVkXG4gIGlmICghdmVjdG9yU3RvcmUgfHwgdmVjdG9yU3RvcmUubGVuZ3RoID09PSAwKSB7XG4gICAgbG9hZFZlY3RvclN0b3JlKCk7XG4gIH1cbiAgXG4gIGlmICghdmVjdG9yU3RvcmUgfHwgdmVjdG9yU3RvcmUubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc29sZS53YXJuKCdWZWN0b3Igc3RvcmUgaXMgZW1wdHkuIE5vIHJlc3VsdHMgdG8gcmV0dXJuLicpO1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ1NlYXJjaGluZyBmb3Igc2ltaWxhciBpdGVtcy4uLicpO1xuICBcbiAgLy8gTG9vayBmb3IgY2VydGFpbiB0eXBlcyBvZiBpbnF1aXJpZXMgdG8gYm9vc3Qgc3BlY2lmaWMgY29udGVudFxuICBsZXQgc2hvdWxkQm9vc3RTdHJ1Y3R1cmVkSW5mbyA9IGZhbHNlO1xuICBsZXQgc2hvdWxkQm9vc3RDb21wYW55VmFsdWVzID0gZmFsc2U7XG4gIGxldCBzaG91bGRCb29zdEludmVzdG9ycyA9IGZhbHNlO1xuICBsZXQgc2hvdWxkQm9vc3RMZWFkZXJzaGlwID0gZmFsc2U7XG4gIGxldCBzaG91bGRCb29zdFByaWNpbmcgPSBmYWxzZTtcbiAgbGV0IHNob3VsZEJvb3N0UHJvZHVjdEZlYXR1cmVzID0gZmFsc2U7XG4gIGxldCBzaG91bGRCb29zdFNhbGVzSW5mbyA9IGZhbHNlO1xuICBcbiAgaWYgKHF1ZXJ5VGV4dCkge1xuICAgIGNvbnN0IHF1ZXJ5TG93ZXIgPSBxdWVyeVRleHQudG9Mb3dlckNhc2UoKTtcbiAgICBcbiAgICAvLyBDaGVjayBmb3IgY29tcGFueSB2YWx1ZXMgaW5xdWlyaWVzXG4gICAgc2hvdWxkQm9vc3RDb21wYW55VmFsdWVzID0gcXVlcnlMb3dlci5pbmNsdWRlcygndmFsdWUnKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdjdWx0dXJlJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygncHJpbmNpcGxlJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdtaXNzaW9uJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCd2aXNpb24nKTtcbiAgICBcbiAgICAvLyBDaGVjayBmb3IgaW52ZXN0b3IgaW5xdWlyaWVzXG4gICAgc2hvdWxkQm9vc3RJbnZlc3RvcnMgPSBxdWVyeUxvd2VyLmluY2x1ZGVzKCdpbnZlc3RvcicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygnZnVuZGluZycpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygnYmFja2VkIGJ5JykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2ludmVzdGVkJyk7XG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIGxlYWRlcnNoaXAgaW5xdWlyaWVzXG4gICAgc2hvdWxkQm9vc3RMZWFkZXJzaGlwID0gcXVlcnlMb3dlci5pbmNsdWRlcygnZm91bmRlcicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2NlbycpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2xlYWRlcicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygnZXhlY3V0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgLy8gQ2hlY2sgZm9yIHByaWNpbmcgaW5xdWlyaWVzXG4gICAgc2hvdWxkQm9vc3RQcmljaW5nID0gcXVlcnlMb3dlci5pbmNsdWRlcygncHJpY2luZycpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygncHJpY2UnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2Nvc3QnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ3N1YnNjcmlwdGlvbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygncGxhbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygndGllcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgIC8vIENoZWNrIGZvciBwcm9kdWN0IGZlYXR1cmUgaW5xdWlyaWVzICBcbiAgICBzaG91bGRCb29zdFByb2R1Y3RGZWF0dXJlcyA9IHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2ZlYXR1cmUnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdmdW5jdGlvbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2NhcGFiaWxpdHknKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdob3cgZG9lcyBpdCB3b3JrJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlMb3dlci5pbmNsdWRlcygnd2hhdCBkb2VzIGl0IGRvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgIC8vIENoZWNrIGZvciBzYWxlcyBpbmZvcm1hdGlvbiBpbnF1aXJpZXNcbiAgICBzaG91bGRCb29zdFNhbGVzSW5mbyA9IHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ3NlbGwnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdwaXRjaCcpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2NvbXBldGl0b3InKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUxvd2VyLmluY2x1ZGVzKCdjb21wYXJpc29uJyk7XG4gICAgXG4gICAgLy8gU2V0IHRoZSBvdmVyYWxsIHN0cnVjdHVyZWQgaW5mbyBmbGFnIGlmIGFueSBzcGVjaWZpYyB0eXBlIHNob3VsZCBiZSBib29zdGVkXG4gICAgc2hvdWxkQm9vc3RTdHJ1Y3R1cmVkSW5mbyA9IHNob3VsZEJvb3N0Q29tcGFueVZhbHVlcyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQm9vc3RJbnZlc3RvcnMgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZEJvb3N0TGVhZGVyc2hpcCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRCb29zdFByaWNpbmcgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQm9vc3RQcm9kdWN0RmVhdHVyZXMgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQm9vc3RTYWxlc0luZm87XG4gIH1cbiAgXG4gIC8vIENhbGN1bGF0ZSBzaW1pbGFyaXR5IHNjb3Jlc1xuICBjb25zdCBpdGVtc1dpdGhTY29yZXMgPSB2ZWN0b3JTdG9yZS5tYXAoaXRlbSA9PiB7XG4gICAgLy8gQ29tcHV0ZSBiYXNlIHNjb3JlIHVzaW5nIGNvc2luZSBzaW1pbGFyaXR5XG4gICAgbGV0IHNjb3JlID0gY29zaW5lU2ltaWxhcml0eShxdWVyeUVtYmVkZGluZywgaXRlbS5lbWJlZGRpbmcpO1xuICAgIFxuICAgIC8vIEFwcGx5IGJvb3N0aW5nIGZvciBzdHJ1Y3R1cmVkIGluZm9ybWF0aW9uIHdoZW4gcmVsZXZhbnRcbiAgICBpZiAoc2hvdWxkQm9vc3RTdHJ1Y3R1cmVkSW5mbyAmJiBpdGVtLm1ldGFkYXRhPy5pc1N0cnVjdHVyZWQpIHtcbiAgICAgIC8vIFNwZWNpZmljIGJvb3N0cyBmb3IgZGlmZmVyZW50IHR5cGVzIG9mIHN0cnVjdHVyZWQgaW5mb3JtYXRpb25cbiAgICAgIGNvbnN0IGluZm9UeXBlID0gaXRlbS5tZXRhZGF0YT8uaW5mb1R5cGU7XG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVuIGEgc3BlY2lmaWMgaW5mbyB0eXBlIGlzIHByaW9yaXRpemVkXG4gICAgICBpZiAocHJpb3JpdHlJbmZvVHlwZSAmJiBpbmZvVHlwZSA9PT0gcHJpb3JpdHlJbmZvVHlwZSkge1xuICAgICAgICBzY29yZSAqPSAxLjU7IC8vIFN0cm9uZyBib29zdCBmb3IgZXhhY3QgaW5mbyB0eXBlIG1hdGNoXG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UsIGFwcGx5IHN0YW5kYXJkIGJvb3N0c1xuICAgICAgZWxzZSBpZiAoc2hvdWxkQm9vc3RDb21wYW55VmFsdWVzICYmIGluZm9UeXBlID09PSAnY29tcGFueV92YWx1ZXMnKSB7XG4gICAgICAgIHNjb3JlICo9IDEuMztcbiAgICAgIH0gZWxzZSBpZiAoc2hvdWxkQm9vc3RJbnZlc3RvcnMgJiYgaW5mb1R5cGUgPT09ICdpbnZlc3RvcnMnKSB7XG4gICAgICAgIHNjb3JlICo9IDEuMztcbiAgICAgIH0gZWxzZSBpZiAoc2hvdWxkQm9vc3RMZWFkZXJzaGlwICYmIGluZm9UeXBlID09PSAnbGVhZGVyc2hpcCcpIHtcbiAgICAgICAgc2NvcmUgKj0gMS4zO1xuICAgICAgfSBlbHNlIGlmIChzaG91bGRCb29zdFByaWNpbmcgJiYgaW5mb1R5cGUgPT09ICdwcmljaW5nJykge1xuICAgICAgICBzY29yZSAqPSAxLjM7XG4gICAgICB9IGVsc2UgaWYgKHNob3VsZEJvb3N0UHJvZHVjdEZlYXR1cmVzICYmIGluZm9UeXBlID09PSAncHJvZHVjdF9mZWF0dXJlcycpIHtcbiAgICAgICAgc2NvcmUgKj0gMS4zO1xuICAgICAgfSBlbHNlIGlmIChzaG91bGRCb29zdFNhbGVzSW5mbyAmJiBpbmZvVHlwZSA9PT0gJ3NhbGVzX2luZm8nKSB7XG4gICAgICAgIHNjb3JlICo9IDEuMztcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS5tZXRhZGF0YT8uaXNTdHJ1Y3R1cmVkKSB7XG4gICAgICAgIC8vIEdlbmVyYWwgYm9vc3QgZm9yIGFueSBzdHJ1Y3R1cmVkIGluZm9cbiAgICAgICAgc2NvcmUgKj0gMS4xO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyAuLi5pdGVtLCBzY29yZSB9O1xuICB9KTtcbiAgXG4gIC8vIFNvcnQgYnkgc2ltaWxhcml0eSBzY29yZVxuICBjb25zdCBzb3J0ZWRSZXN1bHRzID0gaXRlbXNXaXRoU2NvcmVzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgXG4gIC8vIEdldCB0aGUgdG9wIHJlc3VsdHMsIGJ1dCBlbnN1cmUgcHJpb3JpdHkgc3RydWN0dXJlZCBpbmZvIGlzIGluY2x1ZGVkIGlmIHJlbGV2YW50XG4gIGxldCByZXN1bHQgPSBzb3J0ZWRSZXN1bHRzLnNsaWNlKDAsIGxpbWl0KTtcbiAgXG4gIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gZ3VhcmFudGVlIGluY2x1c2lvbiBvZiBzcGVjaWZpYyBzdHJ1Y3R1cmVkIGluZm9cbiAgaWYgKHNob3VsZEJvb3N0U3RydWN0dXJlZEluZm8pIHtcbiAgICAvLyBDaGVjayBpZiB3ZSBhbHJlYWR5IGhhdmUgYSByZWxldmFudCBwaWVjZSBvZiBzdHJ1Y3R1cmVkIGluZm9ybWF0aW9uXG4gICAgbGV0IGhhc1JlbGV2YW50U3RydWN0dXJlZEluZm8gPSBmYWxzZTtcbiAgICBcbiAgICAvLyBVc2UgdGhlIHByaW9yaXR5SW5mb1R5cGUgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UgY2hlY2sgYWxsIHJlbGV2YW50IHR5cGVzXG4gICAgaWYgKHByaW9yaXR5SW5mb1R5cGUpIHtcbiAgICAgIGhhc1JlbGV2YW50U3RydWN0dXJlZEluZm8gPSByZXN1bHQuc29tZShcbiAgICAgICAgaXRlbSA9PiBpdGVtLm1ldGFkYXRhPy5pbmZvVHlwZSA9PT0gcHJpb3JpdHlJbmZvVHlwZVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFzUmVsZXZhbnRTdHJ1Y3R1cmVkSW5mbyA9IHJlc3VsdC5zb21lKGl0ZW0gPT4ge1xuICAgICAgICBjb25zdCBpbmZvVHlwZSA9IGl0ZW0ubWV0YWRhdGE/LmluZm9UeXBlO1xuICAgICAgICByZXR1cm4gKHNob3VsZEJvb3N0Q29tcGFueVZhbHVlcyAmJiBpbmZvVHlwZSA9PT0gJ2NvbXBhbnlfdmFsdWVzJykgfHxcbiAgICAgICAgICAgICAgIChzaG91bGRCb29zdEludmVzdG9ycyAmJiBpbmZvVHlwZSA9PT0gJ2ludmVzdG9ycycpIHx8XG4gICAgICAgICAgICAgICAoc2hvdWxkQm9vc3RMZWFkZXJzaGlwICYmIGluZm9UeXBlID09PSAnbGVhZGVyc2hpcCcpIHx8XG4gICAgICAgICAgICAgICAoc2hvdWxkQm9vc3RQcmljaW5nICYmIGluZm9UeXBlID09PSAncHJpY2luZycpIHx8XG4gICAgICAgICAgICAgICAoc2hvdWxkQm9vc3RQcm9kdWN0RmVhdHVyZXMgJiYgaW5mb1R5cGUgPT09ICdwcm9kdWN0X2ZlYXR1cmVzJykgfHxcbiAgICAgICAgICAgICAgIChzaG91bGRCb29zdFNhbGVzSW5mbyAmJiBpbmZvVHlwZSA9PT0gJ3NhbGVzX2luZm8nKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIHRoZSByZWxldmFudCBpbmZvIGluIG91ciB0b3AgcmVzdWx0cywgZmluZCBhbmQgaW5jbHVkZSBpdFxuICAgIGlmICghaGFzUmVsZXZhbnRTdHJ1Y3R1cmVkSW5mbykge1xuICAgICAgbGV0IHN0cnVjdHVyZWRJbmZvVG9JbmNsdWRlO1xuICAgICAgXG4gICAgICBpZiAocHJpb3JpdHlJbmZvVHlwZSkge1xuICAgICAgICAvLyBMb29rIGZvciB0aGUgc3BlY2lmaWMgcHJpb3JpdHkgaW5mbyB0eXBlXG4gICAgICAgIHN0cnVjdHVyZWRJbmZvVG9JbmNsdWRlID0gc29ydGVkUmVzdWx0cy5maW5kKFxuICAgICAgICAgIGl0ZW0gPT4gaXRlbS5tZXRhZGF0YT8uaW5mb1R5cGUgPT09IHByaW9yaXR5SW5mb1R5cGUgJiYgIXJlc3VsdC5pbmNsdWRlcyhpdGVtKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTG9vayBmb3IgYW55IHJlbGV2YW50IHN0cnVjdHVyZWQgaW5mbyB0eXBlXG4gICAgICAgIHN0cnVjdHVyZWRJbmZvVG9JbmNsdWRlID0gc29ydGVkUmVzdWx0cy5maW5kKGl0ZW0gPT4ge1xuICAgICAgICAgIGNvbnN0IGluZm9UeXBlID0gaXRlbS5tZXRhZGF0YT8uaW5mb1R5cGU7XG4gICAgICAgICAgcmV0dXJuICgoc2hvdWxkQm9vc3RDb21wYW55VmFsdWVzICYmIGluZm9UeXBlID09PSAnY29tcGFueV92YWx1ZXMnKSB8fFxuICAgICAgICAgICAgICAgICAoc2hvdWxkQm9vc3RJbnZlc3RvcnMgJiYgaW5mb1R5cGUgPT09ICdpbnZlc3RvcnMnKSB8fFxuICAgICAgICAgICAgICAgICAoc2hvdWxkQm9vc3RMZWFkZXJzaGlwICYmIGluZm9UeXBlID09PSAnbGVhZGVyc2hpcCcpIHx8XG4gICAgICAgICAgICAgICAgIChzaG91bGRCb29zdFByaWNpbmcgJiYgaW5mb1R5cGUgPT09ICdwcmljaW5nJykgfHxcbiAgICAgICAgICAgICAgICAgKHNob3VsZEJvb3N0UHJvZHVjdEZlYXR1cmVzICYmIGluZm9UeXBlID09PSAncHJvZHVjdF9mZWF0dXJlcycpIHx8XG4gICAgICAgICAgICAgICAgIChzaG91bGRCb29zdFNhbGVzSW5mbyAmJiBpbmZvVHlwZSA9PT0gJ3NhbGVzX2luZm8nKSkgJiZcbiAgICAgICAgICAgICAgICAgIXJlc3VsdC5pbmNsdWRlcyhpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIHdlIGZvdW5kIGEgcmVsZXZhbnQgaXRlbSwgYWRkIGl0IGFuZCByZW1vdmUgdGhlIGxvd2VzdCBzY29yZWQgaXRlbVxuICAgICAgaWYgKHN0cnVjdHVyZWRJbmZvVG9JbmNsdWRlKSB7XG4gICAgICAgIHJlc3VsdC5wb3AoKTsgLy8gUmVtb3ZlIHRoZSBsb3dlc3Qgc2NvcmVkIGl0ZW1cbiAgICAgICAgcmVzdWx0LnB1c2goc3RydWN0dXJlZEluZm9Ub0luY2x1ZGUpO1xuICAgICAgICAvLyBSZS1zb3J0IHRvIG1haW50YWluIHNjb3JlIG9yZGVyXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIENsZWFyIHRoZSB2ZWN0b3Igc3RvcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVmVjdG9yU3RvcmUoKTogdm9pZCB7XG4gIC8vIENsZWFyIGluLW1lbW9yeSBkYXRhXG4gIHZlY3RvclN0b3JlID0gW107XG4gIFxuICAvLyBEZWxldGUgYWxsIGJhdGNoIGZpbGVzXG4gIHRyeSB7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoVkVDVE9SX1NUT1JFX0RJUikpIHtcbiAgICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoVkVDVE9SX1NUT1JFX0RJUik7XG4gICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICBpZiAoZmlsZS5zdGFydHNXaXRoKCdiYXRjaF8nKSkge1xuICAgICAgICAgIGZzLnVubGlua1N5bmMocGF0aC5qb2luKFZFQ1RPUl9TVE9SRV9ESVIsIGZpbGUpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJlc2V0IGJhdGNoIGluZGV4XG4gICAgYWN0aXZlQmF0Y2hlcyA9IFtdO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoQkFUQ0hfSU5ERVhfRklMRSwgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgYWN0aXZlQmF0Y2hlczogW10sXG4gICAgICBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKVxuICAgIH0sIG51bGwsIDIpKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnVmVjdG9yIHN0b3JlIGNsZWFyZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2xlYXJpbmcgdmVjdG9yIHN0b3JlOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBzaXplIG9mIHRoZSB2ZWN0b3Igc3RvcmVcbiAqIEByZXR1cm5zIE51bWJlciBvZiBpdGVtcyBpbiB0aGUgdmVjdG9yIHN0b3JlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRWZWN0b3JTdG9yZVNpemUoKTogbnVtYmVyIHtcbiAgcmV0dXJuIHZlY3RvclN0b3JlLmxlbmd0aDtcbn1cblxuLy8gSW5pdGlhbGl6ZSB2ZWN0b3Igc3RvcmUgb24gbW9kdWxlIGxvYWRcbnRyeSB7XG4gIGxvYWRWZWN0b3JTdG9yZSgpO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgdmVjdG9yIHN0b3JlOicsIGVycm9yKTtcbiAgdmVjdG9yU3RvcmUgPSBbXTtcbiAgYWN0aXZlQmF0Y2hlcyA9IFtdO1xufVxuXG4vKipcbiAqIEdldCBhbGwgaXRlbXMgZnJvbSB0aGUgdmVjdG9yIHN0b3JlXG4gKiBAcmV0dXJucyBBcnJheSBvZiBhbGwgdmVjdG9yIHN0b3JlIGl0ZW1zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxWZWN0b3JTdG9yZUl0ZW1zKCk6IFZlY3RvclN0b3JlSXRlbVtdIHtcbiAgcmV0dXJuIFsuLi52ZWN0b3JTdG9yZV07XG59XG5cbmV4cG9ydCB7IHZlY3RvclN0b3JlIH07ICJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJWRUNUT1JfU1RPUkVfRElSIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJCQVRDSF9JTkRFWF9GSUxFIiwiTUFYX0JBVENIX1NJWkUiLCJ2ZWN0b3JTdG9yZSIsImFjdGl2ZUJhdGNoZXMiLCJpbml0VmVjdG9yU3RvcmUiLCJkYXRhRGlyIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsIndyaXRlRmlsZVN5bmMiLCJKU09OIiwic3RyaW5naWZ5IiwibGFzdFVwZGF0ZWQiLCJEYXRlIiwibm93IiwibG9hZFZlY3RvclN0b3JlIiwiY29uc29sZSIsImxvZyIsImluZGV4RGF0YSIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwidG90YWxMb2FkZWQiLCJiYXRjaElkIiwiYmF0Y2hGaWxlIiwiYmF0Y2hEYXRhIiwibGVuZ3RoIiwiZXJyb3IiLCJzaW5nbGVTdG9yZUZpbGUiLCJmaWxlRGF0YSIsInBhcnNlZERhdGEiLCJBcnJheSIsImlzQXJyYXkiLCJpdGVtcyIsImNyZWF0ZU5ld0JhdGNoIiwidG9TdHJpbmciLCJwdXNoIiwic2F2ZUJhdGNoIiwic2F2ZVZlY3RvclN0b3JlIiwiaW5pdGlhbEJhdGNoSWQiLCJtYXAiLCJpdGVtIiwibWV0YWRhdGEiLCJiYXRjaCIsImJhdGNoTWFwIiwidW5iYXRjaGVkSXRlbXMiLCJmaWx0ZXIiLCJjdXJyZW50QmF0Y2hJZCIsImN1cnJlbnRCYXRjaENvdW50IiwiZm9yRWFjaCIsIk9iamVjdCIsImVudHJpZXMiLCJjb3NpbmVTaW1pbGFyaXR5IiwidmVjQSIsInZlY0IiLCJkb3QiLCJyZWR1Y2UiLCJzdW0iLCJhIiwiaSIsIm1hZ0EiLCJNYXRoIiwic3FydCIsIm1hZ0IiLCJiIiwiYWRkVG9WZWN0b3JTdG9yZSIsIml0ZW1zQXJyYXkiLCJnZXRTaW1pbGFySXRlbXMiLCJxdWVyeUVtYmVkZGluZyIsImxpbWl0IiwicXVlcnlUZXh0IiwicHJpb3JpdHlJbmZvVHlwZSIsIndhcm4iLCJzaG91bGRCb29zdFN0cnVjdHVyZWRJbmZvIiwic2hvdWxkQm9vc3RDb21wYW55VmFsdWVzIiwic2hvdWxkQm9vc3RJbnZlc3RvcnMiLCJzaG91bGRCb29zdExlYWRlcnNoaXAiLCJzaG91bGRCb29zdFByaWNpbmciLCJzaG91bGRCb29zdFByb2R1Y3RGZWF0dXJlcyIsInNob3VsZEJvb3N0U2FsZXNJbmZvIiwicXVlcnlMb3dlciIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJpdGVtc1dpdGhTY29yZXMiLCJzY29yZSIsImVtYmVkZGluZyIsImlzU3RydWN0dXJlZCIsImluZm9UeXBlIiwic29ydGVkUmVzdWx0cyIsInNvcnQiLCJyZXN1bHQiLCJzbGljZSIsImhhc1JlbGV2YW50U3RydWN0dXJlZEluZm8iLCJzb21lIiwic3RydWN0dXJlZEluZm9Ub0luY2x1ZGUiLCJmaW5kIiwicG9wIiwiY2xlYXJWZWN0b3JTdG9yZSIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmaWxlIiwic3RhcnRzV2l0aCIsInVubGlua1N5bmMiLCJnZXRWZWN0b3JTdG9yZVNpemUiLCJnZXRBbGxWZWN0b3JTdG9yZUl0ZW1zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./utils/vectorStore.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fdocuments&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fadmin%2Fdocuments.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();